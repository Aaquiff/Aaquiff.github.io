<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Bare Metal Kubernetes Cluster | Aaquiff Ahnaff Rauf</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Bare Metal Kubernetes Cluster" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Kubernetes is an open source project initiated by google to ease the pain of deploying, managing and scaling containerized applications. There exists many flavors of kubernetes clouds such as" />
<meta property="og:description" content="Kubernetes is an open source project initiated by google to ease the pain of deploying, managing and scaling containerized applications. There exists many flavors of kubernetes clouds such as" />
<link rel="canonical" href="http://localhost:4000/kubrnetes/2019/02/01/bare-metal-kubernetes-cluster.html" />
<meta property="og:url" content="http://localhost:4000/kubrnetes/2019/02/01/bare-metal-kubernetes-cluster.html" />
<meta property="og:site_name" content="Aaquiff Ahnaff Rauf" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-02-01T00:00:00+05:30" />
<script type="application/ld+json">
{"url":"http://localhost:4000/kubrnetes/2019/02/01/bare-metal-kubernetes-cluster.html","headline":"Bare Metal Kubernetes Cluster","dateModified":"2019-02-01T00:00:00+05:30","datePublished":"2019-02-01T00:00:00+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/kubrnetes/2019/02/01/bare-metal-kubernetes-cluster.html"},"description":"Kubernetes is an open source project initiated by google to ease the pain of deploying, managing and scaling containerized applications. There exists many flavors of kubernetes clouds such as","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Aaquiff Ahnaff Rauf" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Aaquiff Ahnaff Rauf</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Bare Metal Kubernetes Cluster</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-02-01T00:00:00+05:30" itemprop="datePublished">Feb 1, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Kubernetes is an open source project initiated by google to ease the pain of deploying, managing and scaling containerized applications. There exists many flavors of kubernetes clouds such as</p>

<ul>
  <li>GKE (Google’s very own kubernetes engine)</li>
  <li>AWS Eks</li>
  <li>Openshift</li>
</ul>

<p>If you are new to kubernetes and feel the need to experiment you could always try the single node solutions given below or utilize the free credit on GKE.</p>

<ul>
  <li>Minikube</li>
  <li>Minishift</li>
</ul>

<p>However if you are feeling a bit more adventurous and have some computing power to spare you could always bootstrap your own kubernetes cluster effortlessly. You would need two machines at-least for this and static IPs within the network to find them.</p>

<p>In this single node setup one machine will be the master while the other a node. All nodes(including the master) requires some basic tools to create and join the cluster. Docker, kubelet, kubectl(optional). In addition to those the master will need kubeadm to administrate the cluster.</p>

<p>If you are planning to access the cluster from a different machine (most probable scenario) you would need kubectl installed in that machine. kubectl is a kubernetes client application written in GO that could talk to the kubernetes API that we are going to setup in the master node.</p>

<h1 id="setting-up-the-master">Setting up the master</h1>

<p>SSH into the master machine and use the following commands to install the required tools.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> apt-transport-https
curl <span class="nt">-s</span> https://download.docker.com/linux/ubuntu/gpg | <span class="nb">sudo </span>apt-key add -
add-apt-repository <span class="se">\</span>
<span class="s2">"deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"</span>
apt update <span class="o">&amp;&amp;</span> apt <span class="nb">install</span> <span class="nt">-qy</span> docker-ce
curl <span class="nt">-s</span> https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
<span class="nb">echo</span> <span class="s2">"deb http://apt.kubernetes.io/ kubernetes-xenial main"</span> <span class="se">\</span>
    <span class="o">&gt;</span> /etc/apt/sources.list.d/kubernetes.list
apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> kubeadm kubelet kubectl
</code></pre></div></div>

<p>Use <strong>KUBEADM</strong> to initialise the cluster using the following command where **<MASTER_IP>** is the IP of the master 
machine that the nodes could find and –pod-network-cidr could be any range of IP addresses that the pods inside the clusters can be assigned to. This network range is isolated from the external network and only used for inter-cluster communication. However it should be noted that assigning the IP range as same as your network could cause problems.</MASTER_IP></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubeadm init <span class="nt">--apiserver-advertise-address</span><span class="o">=</span>&lt;MASTER_IP&gt; <span class="nt">--pod-network-cidr</span><span class="o">=</span>192.168.1.0/16
</code></pre></div></div>

<p>After the command has run, you will find a command in the output that can be used by the worker nodes to join the cluster initialized by the master.</p>

<p>In addition, you need to setup a CIDR for maintaining the internal network. You could find a few options if you skim through the kubernetes documentation. We chose to go with flannel which could be installed using the command given below.</p>

<h1 id="setting-up-the-worker-nodes">Setting up the worker node(s)</h1>

<p>This is fairly straight forward. Install the dependencies as before using the following commands and use the join command we got earlier.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</code></pre></div></div>
<p>This is fairly straight forward. Install the dependencies as before using the following commands and use the join command we got earlier.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> apt-transport-https
curl <span class="nt">-s</span> https://download.docker.com/linux/ubuntu/gpg | <span class="nb">sudo </span>apt-key add -
add-apt-repository <span class="se">\</span>
    <span class="s2">"deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"</span>
apt update <span class="o">&amp;&amp;</span> apt <span class="nb">install</span> <span class="nt">-qy</span> docker-ce
curl <span class="nt">-s</span> https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
<span class="nb">echo</span> <span class="s2">"deb http://apt.kubernetes.io/ kubernetes-xenial main"</span> <span class="se">\</span>
    <span class="o">&gt;</span> /etc/apt/sources.list.d/kubernetes.list
apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> kubeadm kubelet kubectl
</code></pre></div></div>

<p>If you’ve missed it or you want to join a new node to the cluster, use the following command to get a new token along with the join command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>kubeadm token create <span class="nt">--print-join-command</span>
</code></pre></div></div>

<h1 id="give-it-a-go">Give it a go!</h1>

<p>With the kubernetes configuration we copied earlier from the master, we are now able to connect to the cluster and administrate it using the kubernetes API. To test the nodes in the cluster, use the following command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get nodes
</code></pre></div></div>

<p>If all went well, you should see two nodes including the master and a worker node. You could always expand your cluster by adding new nodes to it by following the steps in the above section.</p>

  </div><a class="u-url" href="/kubrnetes/2019/02/01/bare-metal-kubernetes-cluster.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Aaquiff Ahnaff Rauf</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Aaquiff Ahnaff Rauf</li><li><a class="u-email" href="mailto:aaquiff@gmail.com">aaquiff@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/Aaquiff"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Aaquiff</span></a></li><li><a href="https://www.twitter.com/Aaquiff"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">Aaquiff</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
